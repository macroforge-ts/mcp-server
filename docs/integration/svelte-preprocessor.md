# Svelte Preprocessor
 *The Svelte preprocessor expands Macroforge macros in <code class="shiki-inline"><span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">&<span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">lt;script<span style="--shiki-dark:#F97583;--shiki-light:#D73A49">&<span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">gt;</code> blocks before Svelte compilation, enabling seamless macro usage in Svelte components.*
 ## Installation
 ```
npm install -D @macroforge/svelte-preprocessor
``` ## Configuration
 Add the preprocessor to your <code class="shiki-inline"><span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">svelte.config.js</code>:
 ```
import adapter from '@sveltejs/adapter-auto';
import &#123; vitePreprocess &#125; from '@sveltejs/vite-plugin-svelte';
import &#123; macroforgePreprocess &#125; from '@macroforge/svelte-preprocessor';

/** @type &#123;import('@sveltejs/kit').Config&#125; */
const config = &#123;
  preprocess: [
    macroforgePreprocess(),  // Expand macros FIRST
    vitePreprocess()          // Then handle TypeScript/CSS
  ],

  kit: &#123;
    adapter: adapter()
  &#125;
&#125;;

export default config;
```  **Warning Always place **<code class="shiki-inline"><span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">macroforgePreprocess<span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">()</code> **before** other preprocessors like <code class="shiki-inline"><span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">vitePreprocess<span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">()</code>. This ensures macros are expanded before TypeScript compilation. ## Usage
 Use <code class="shiki-inline"><span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">@derive</code> decorators directly in your Svelte component scripts:
 ```
&#x3C;script lang="ts">
  /** @derive(Debug, Clone) */
  class User &#123;
    name: string;
    email: string;

    constructor(name: string, email: string) &#123;
      this.name = name;
      this.email = email;
    &#125;
  &#125;

  let user = new User("Alice", "alice@example.com");
  console.log(user.toString());  // Generated by Debug macro
&#x3C;/script>

&#x3C;p>User: &#123;user.name&#125;&#x3C;/p>
``` ## Options
 ```
macroforgePreprocess(&#123;
  // Keep @derive decorators in output (for debugging)
  keepDecorators: false,

  // Process JavaScript files (not just TypeScript)
  processJavaScript: false
&#125;)
``` ### Option Reference
 | Option | Type | Default | Description |
| --- | --- | --- | --- |
| keepDecorators | boolean | false | Keep decorators in output |
| processJavaScript | boolean | false | Process &lt;script&gt; blocks without lang="ts" |
 ## How It Works
 The preprocessor:
 1. Intercepts <code class="shiki-inline"><span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">&<span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">lt;script lang<span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=<span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">"ts"<span style="--shiki-dark:#F97583;--shiki-light:#D73A49">&<span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">gt;</code> blocks in <code class="shiki-inline"><span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.svelte</code> files
 2. Checks for <code class="shiki-inline"><span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">@derive</code> decorators (skips files without them)
 3. Expands macros using the native Macroforge binary
 4. Returns the transformed code for Svelte compilation
  **Tip Files without **<code class="shiki-inline"><span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">@derive</code> decorators are passed through unchanged with zero overhead. ## SvelteKit Integration
 For SvelteKit projects, you can use both the preprocessor (for <code class="shiki-inline"><span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.svelte</code> files) and the Vite plugin (for standalone <code class="shiki-inline"><span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.ts</code> files):
 ```
// svelte.config.js
import &#123; macroforgePreprocess &#125; from '@macroforge/svelte-preprocessor';
import &#123; vitePreprocess &#125; from '@sveltejs/vite-plugin-svelte';

export default &#123;
  preprocess: [
    macroforgePreprocess(),
    vitePreprocess()
  ]
&#125;;
``` ```
// vite.config.ts
import macroforge from '@macroforge/vite-plugin';
import &#123; sveltekit &#125; from '@sveltejs/kit/vite';
import &#123; defineConfig &#125; from 'vite';

export default defineConfig(&#123;
  plugins: [
    macroforge(),  // For .ts files
    sveltekit()
  ]
&#125;);
``` ## Using with Vitest
 The preprocessor works seamlessly with Vitest for testing Svelte components:
 ```
// vitest.config.ts
import &#123; defineConfig &#125; from 'vitest/config';
import &#123; sveltekit &#125; from '@sveltejs/kit/vite';
import &#123; svelteTesting &#125; from '@testing-library/svelte/vite';
import macroforge from '@macroforge/vite-plugin';

export default defineConfig(&#123;
  plugins: [
    macroforge(),
    sveltekit(),
    svelteTesting()
  ],
  test: &#123;
    environment: 'jsdom',
    include: ['src/**/*.&#123;test,spec&#125;.&#123;js,ts&#125;']
  &#125;
&#125;);
``` ## Svelte 5 Runes Compatibility
 The preprocessor is fully compatible with Svelte 5 runes (<code class="shiki-inline"><span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">$state</code>, <code class="shiki-inline"><span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">$derived</code>, <code class="shiki-inline"><span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">$props</code>, etc.). Files using runes but without <code class="shiki-inline"><span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">@derive</code> decorators are skipped entirely.
 ```
&#x3C;script lang="ts">
  // Runes work normally
  let count = $state(0);
  let doubled = $derived(count * 2);

  // Macros expand correctly
  /** @derive(Debug) */
  class Counter &#123;
    value: number;
    constructor(value: number) &#123;
      this.value = value;
    &#125;
  &#125;
&#x3C;/script>
```